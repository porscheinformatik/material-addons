@use 'sass:map';
@use '@angular/material' as mat;

// Global theme state variables for M3
$m3-theme: undefined;
$m3-custom-colors: undefined;
$primary-color: undefined;
$tertiary-color: undefined;
$background-color: undefined;
$default-palette: undefined;

@function build-custom-theme-m3($theme-name, $primary-hex, $tertiary-hex, $custom-colors, $default-colors, $background-hex: #fafafa) {
  // Create M3 theme with custom primary color
  $theme: mat.define-theme((
    color: (
      theme-type: light,
      primary: mat.$cyan-palette,  // Will be overridden by primary-hex in CSS variables
      tertiary: mat.$blue-palette  // Will be overridden by tertiary-hex in CSS variables
    ),
    typography: (
      brand-family: 'Roboto',
      plain-family: 'Roboto'
    ),
    density: (
      scale: 0
    )
  ));

  // Store theme data globally for CSS variable generation
  $m3-theme: $theme !global;
  $m3-custom-colors: $custom-colors !global;
  $primary-color: $primary-hex !global;
  $tertiary-color: $tertiary-hex !global;
  $background-color: $background-hex !global;
  $default-palette: $default-colors !global;

  @return $theme;
}

// Utility functions for M3 theme (backward compatibility with M2 patterns)
@function get-main-color() {
  @return $primary-color;
}

@function get-selection-background() {
  // M3 equivalent: lighten primary color significantly
  @return mix(white, $primary-color, 90%);
}

@function get-table-hover-color($color) {
  @return rgba($color, 0.08);
}

@function get-background-color() {
  @return $background-color;
}

@function get-hover-color() {
  // M3 equivalent: very light primary
  @return mix(white, $primary-color, 90%);
}

@function get-panel-color() {
  // M3 equivalent: darker primary
  @return mix(black, $primary-color, 30%);
}

@function get-custom-color($key) {
  @return map.get($m3-custom-colors, $key);
}

@function map-get-or-default($theme-map, $key) {
  $key-exists: map-has-key($theme-map, $key);
  @return map-get(if($key-exists, $theme-map, $default-palette), $key);
}
